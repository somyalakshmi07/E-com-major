<%- include('partials/header') %>

    <main class="cart-page">
        <div class="container">
            <h1>Your Shopping Cart</h1>
            
            <% if (cartItems.length === 0) { %>
                <div class="empty-cart">
                    <p>Your cart is empty</p>
                    <a href="/shop" class="btn">Continue Shopping</a>
                </div>
            <% } else { %>
                <div class="cart-grid">
                    <div class="cart-items">
                        <% cartItems.forEach(item => { %>
                            <div class="cart-item">
                                <div class="item-image" style="background-image: url('<%= item.image %>')"></div>
                                <div class="item-details">
                                    <h3><%= item.name %></h3>
                                    <p class="item-category"><%= item.category %></p>
                                    <p class="item-price">$<%= item.price.toFixed(2) %></p>
                                </div>
                                <div class="item-quantity">
                                    <button class="quantity-btn" data-id="<%= item.id %>" data-action="decrease">-</button>
                                    <span class="quantity"><%= item.quantity %></span>
                                    <button class="quantity-btn" data-id="<%= item.id %>" data-action="increase">+</button>
                                </div>
                                <div class="item-total">
                                    $<%= (item.price * item.quantity).toFixed(2) %>
                                </div>
                                <button class="remove-item" data-id="<%= item.id %>">Ã—</button>
                            </div>
                        <% }); %>
                    </div>
                    
                    <div class="cart-summary">
                        <h2>Order Summary</h2>
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span>$<%= subtotal %></span>
                        </div>
                        <div class="summary-row">
                            <span>Tax (10%)</span>
                            <span>$<%= tax %></span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping</span>
                            <span>$<%= shipping %></span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span>$<%= total %></span>
                        </div>
                        <a href="/checkout" class="btn checkout-btn">Proceed to Checkout</a>
                        <a href="/shop" class="continue-shopping">Continue Shopping</a>
                    </div>
                </div>
            <% } %>
        </div>
    </main>

<%- include('partials/footer') %>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Quantity adjustment
        document.querySelectorAll('.quantity-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.getAttribute('data-id');
                const action = this.getAttribute('data-action');
                const quantityElement = this.parentElement.querySelector('.quantity');
                let quantity = parseInt(quantityElement.textContent);
                
                if (action === 'increase') {
                    quantity++;
                } else if (action === 'decrease' && quantity > 1) {
                    quantity--;
                }
                
                fetch('/cart/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ productId, quantity }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        quantityElement.textContent = quantity;
                        location.reload(); // Refresh to update totals
                    }
                });
            });
        });
        
        // Remove item
        document.querySelectorAll('.remove-item').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.getAttribute('data-id');
                
                fetch('/cart/remove', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ productId }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    }
                });
            });
        });
    });
</script>