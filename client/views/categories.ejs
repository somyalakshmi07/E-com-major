<%- include('partials/header') %>

    <main class="categories-page">
        <!-- Seasonal Banner -->
        <section class="seasonal-banner" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('/images/<%= seasonalBanner.image %>')">
            <div class="container">
                <div class="banner-content">
                    <h2><%= seasonalBanner.title %></h2>
                    <p><%= seasonalBanner.subtitle %></p>
                    <a href="<%= seasonalBanner.link %>" class="btn">Shop Now</a>
                </div>
            </div>
        </section>

        <section class="categories-hero">
            <div class="container">
                <h1>Explore Our Categories</h1>
                <p>Find everything you need for your child's happiness and development</p>
            </div>
        </section>

        <section class="categories-list">
            <div class="container">
                <div class="category-grid">
                    <% categories.forEach(category => { %>
                        <div class="category-card">
                            <a href="/shop?category=<%= category.value %>" class="category-image-link">
                                <div class="category-image" style="background-image: url('/images/<%= category.image %>')">
                                    <div class="category-overlay">
                                        <span class="category-icon"><%= category.icon %></span>
                                        <h3><%= category.name %></h3>
                                    </div>
                                </div>
                            </a>
                            <div class="category-info">
                                <p><%= category.description %></p>
                                <div class="product-count"><%= category.count %> products</div>
                                
                                <div class="subcategories">
                                    <h4>Subcategories:</h4>
                                    <ul>
                                        <% category.subcategories.forEach(subcat => { %>
                                            <li><a href="/shop?category=<%= category.value %>&search=<%= subcat %>"><%= subcat %></a></li>
                                        <% }); %>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </section>

        <!-- New Arrivals Section -->
        <section class="new-arrivals">
            <div class="container">
                <h2>New Arrivals</h2>
                <div class="product-grid">
                    <% newArrivals.forEach(product => { %>
                        <div class="product-card">
                            <div class="product-image" style="background-image: url('/images/<%= product.image %>')"></div>
                            <div class="product-info">
    <h3><%= product.name %></h3>
    <div class="product-meta">
        <span class="price">$<%= product.price.toFixed(2) %></span>
        <span class="rating">‚≠ê <%= product.rating %></span>
    </div>
    <form class="add-to-cart-form" data-product-id="<%= product._id %>">
        <input type="hidden" name="productId" value="<%= product._id %>">
        <input type="number" name="quantity" value="1" min="1" class="quantity-input">
        <button type="submit" class="add-to-cart-btn">Add to Cart</button>
    </form>
</div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </section>

        <section class="category-features">
            <div class="container">
                <h2>Why Shop by Category?</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üîç</div>
                        <h3>Easy Navigation</h3>
                        <p>Quickly find what you're looking for without endless scrolling</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚è±Ô∏è</div>
                        <h3>Save Time</h3>
                        <p>Browse specific types of products tailored to your needs</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üéØ</div>
                        <h3>Targeted Shopping</h3>
                        <p>Discover related items you might not have considered</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <script> // Quantity controls (for all pages)
    document.querySelectorAll('.quantity-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const input = this.parentElement.querySelector('.quantity-input');
            let value = parseInt(input.value);
            
            if (this.classList.contains('plus')) {
                if (value < parseInt(input.max)) {
                    input.value = value + 1;
                }
            } else {
                if (value > parseInt(input.min)) {
                    input.value = value - 1;
                }
            }
        });
    });

    // Add to cart functionality (for all pages)
    document.querySelectorAll('.add-to-cart-form').forEach(form => {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                productId: this.querySelector('[name="productId"]').value,
                quantity: parseInt(this.querySelector('[name="quantity"]').value) || 1
            };

            try {
                const response = await fetch('/cart/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.className = 'cart-success-message';
                    successMsg.textContent = '‚úì Added to cart!';
                    this.appendChild(successMsg);
                    
                    // Update cart count in header
                    if (data.cartItemCount) {
                        const cartCount = document.querySelector('.cart-count');
                        if (cartCount) cartCount.textContent = data.cartItemCount;
                    }
                    
                    // Remove message after 2 seconds
                    setTimeout(() => {
                        successMsg.remove();
                    }, 2000);
                } else {
                    alert('Error: ' + (data.message || 'Failed to add to cart'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to add to cart. Please try again.');
            }
        });
    });</script>

<%- include('partials/footer') %>